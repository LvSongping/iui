var Inovout={};
Inovout.Element=Class.create({initialize:function(c){var a=this;this.dom=c;this.dom.uid=(new Date).getTime()+""+parseInt(1E5*Math.random(),10);this.eventHnadles={};this.eventCallbacks={};"blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" ").each(function(b){var c=a[b]=new Event(b,a);c._addListener=c.addListener;c.addListener=function(e,l,g){c.hasListeners()||
a.bind(b,function(b){c.fire(a,{target:Inovout.Element.get(b.target)})});c._addListener(e,l,g)}})},complete:function(c,a){var b=Object.isString(c)?c:c.name,d,e=this;if(!(d=this.eventCallbacks[b])){d=this.eventCallbacks[b]=$.Callbacks();var l=jQuery._data(e.dom);e.eventHnadles[b]=l.handle||$.event.dispatch;e.removeEventtLister(b,e.eventHnadles[b]);e.addEventLister(b,function(a){var c=e.eventHnadles[b].apply(e.dom,arguments);d.fire(a);return c})}d.add(a)},addEventLister:function(c,a){var b=this.dom;
b.addEventListener?b.addEventListener(c,a,!1):b.attachEvent&&b.attachEvent("on"+c,a)},removeEventtLister:function(c,a){var b=this.dom;if(b.removeEventListener)b.removeEventListener(c,a,!1);else if(b.detachEvent){var d="on"+c;typeof b[d]===core_strundefined&&(b[d]=null);b.detachEvent(d,a)}},getClassName:function(){return this.dom.className},equals:function(c){return this.dom&&c.dom&&this.dom==c.dom},getAttributes:function(){return this.dom.attributes},toString:function(){return this.dom.uid}});
Object.extend(Inovout.Element,{cache:new HashMap,get:function(c){if("string"==typeof c)c=document.getElementById(c);else if(c instanceof Inovout.Element)return c;var a=Inovout.Element.cache.get(c);a||(a=new Inovout.Element(c),Inovout.Element.cache.add(c,a));return a}});Inovout.Element.prototype._initialize=Inovout.Element.prototype.initialize;
Inovout.Element.prototype.initialize=function(c){Object.extend(this,jQuery.fn);this.init(c);var a=this;["find"].each(function(b){a["_"+b]=a[b];a[b]=function(){var c=a["_"+b].apply(a,arguments);return jQuery.map(c,function(a){return Inovout.Element.get(a)})}});Inovout.Element.prototype._initialize.call(this,c)};Inovout.Widgets={};Inovout.View=Class.create({initialize:function(c){this.element=Inovout.Element.get(c);return this}});
Object.extend(Inovout.View,{cache:new HashMap,tryGet:function(c){for(var a in Inovout.Widgets){var b=a.substring(0,1).toLowerCase()+a.substring(1,a.length);if(c.hasClass(b)||a.toLowerCase()==c.dom.tagName.toLowerCase())return a=new Inovout.Widgets[a](c),Inovout.View.cache.add(c,a),a}},get:function(c){if(c instanceof Inovout.View)return c;c=Inovout.Element.get(c);var a=Inovout.View.cache.get(c)||Inovout.View.tryGet(c);a||Object.extend(a,c);return a},buildFunction:function(c,a){a=a.trim();var b=a.indexOf("."),
d=a.substring(0,b);return"this."!=d&&""!=d?(a="Inovout.View.get("+d+")."+a.substring(b,a.length),Function(c,a)):Function.build(c,a)}});iui.load(function(){var c=Inovout.Element.get(document),a;for(a in Inovout.Widgets){var b=a.substring(0,1).toLowerCase()+a.substring(1,a.length);c.find("."+b+","+a).each(function(a){Inovout.View.get(a)})}});
var Page=Class.create(Inovout.View,{initialize:function($super,a){$super(a);return this},init:function(){this.parseEventAdapter(this.element)},parseEventAdapter:function(c){Inovout.Element.get(c).find("[ data-event-adapter]").each(function(a){a.attr("data-event-adapter").split(";").each(function(b){if(""!=b){b=b.split("=");var c=b[0].split("."),c=Inovout.View.get(c[0])[c[1]],c=new EventAdapter(c),e=Inovout.View.get(a);c.addListener(b[1],e)}})})}});iui.context.page=new Page(document);iui.load(function(){iui.context.page.init()});
Inovout.Widgets.List=Class.create(Inovout.View,{initialize:function($super,a){$super(a);this.selectedChanged=new Event("selectedChanged",this);return this},bindData:function(c){Object.isJSON(c)?(element.empty(),$.each(c,function(a,b){this.add(b)})):$.getJSON(c).done(function(a){this.bindData(a)})},wrapEventArgs:function(c){var a={text:c.text()};if(!this.valueKeys){this.valueKeys=[];for(var b=c.getAttributes(),d=0;d<b.length;d++){var e=b[d].name;-1<e.indexOf("data-")&&this.valueKeys.push(e.substring(5,
e.length))}}for(d=0;d<this.valueKeys.length;d++)a[this.valueKeys[d]]=c.data(this.valueKeys[d]);a.value=a.value||c.val()||c.text();return a},valueKeys:void 0});Inovout.Widgets.DropDownList=Class.create(Inovout.Widgets.List,{initialize:function($super,a){$super(a);var b=this;a.change.addListener(function(a,e){var l=b.element.children("option:selected")[0];b.selectedChanged.fire(b,b.wrapEventArgs(l))});return this},add:function(c){this.element.append('<option value="'+c.value+'">'+c.value+"</option>")}});
Inovout.Widgets.TabList=Class.create(Inovout.Widgets.List,{initialize:function($super,a){$super(a);this.selectedChanged=new Event("selectedChanged",this);var b=this;this.element.children().each(function(a){a.click.addListener(function(a,d){var g=b.element.find("li.selected")[0];if(!a.equals(g)){g.removeClass("selected");a.addClass("selected");g={text:a.text()};if(!b.valueKeys){b.valueKeys=[];for(var k=a.getAttributes(),f=0;f<k.length;f++){var h=k[f].name;-1<h.indexOf("data-")&&b.valueKeys.push(h.substring(5,
h.length))}}for(f=0;f<b.valueKeys.length;f++)g[b.valueKeys[f]]=a.attr("data-"+b.valueKeys[f]);g.value=g.value||a.text();b.selectedChanged.fire(b,g)}})});return this},valueKeys:void 0});
Inovout.Widgets.Form=Class.create(Inovout.View,{initialize:function($super,a){function b(b){debugger;var e=new Uri(a.prop("action")),k=a.serializeJSON(),f=new HttpRequest(a.prop("method"),e),h,m=new HttpClient;enctype=a.attr("enctype");if(0<e.uri.indexOf("["))for(name in k)e.uri=e.uri.replace(RegExp("\\["+name+"\\]","ig"),k[name]);"post"==f.method&&("application/x-www-form-urlencoded"==enctype?h=new JsonContent(k):"multipart/related"==enctype&&(e="iui_"+(""+Math.random()).replace(/\D/g,""),h=new MultipartContent("related",
e),h.add(new JsonContent(k)),a.find(".fileInput").each(function(a){h.add(new FileContent(Inovout.View.get(a.fileInput.files[0])))})),f.content=h);m.send(f).read().done(function(a){debugger;Inovout.View.buildFunction("data",b).call(d,a)})}$super(a);var d=this,e=a.data("async");e&&(a.complete(a.submit,function(a){a.defaultPrevented||(a.preventDefault(),a.stopPropagation(),b(e))}),a.find("input[type=file]").each(function(a){var b=$('<div class="fileInput"><button type="button" class="fileInput_browse_button">\u6d4f\u89c8</button></div>')[0];
a.replaceWith(b);Inovout.View.get(b)}));return this}});Inovout.Widgets.FileInput=Class.create(Inovout.View,{initialize:function($super,a){$super(a);var b=this,d={browse_button:a.find(".fileInput_browse_button")[0].dom,container:a.dom};a.data("multiple")&&(d.multiple=!0);this.fileInput=new o.FileInput(d);this.fileInput.init();this.selectedChanged=new Event("selectedChanged",this);a.change.addListener(function(a,d){b.selectedChanged.fire(b,b.fileInput.files)});return this}});
Inovout.Widgets.DataChart=Class.create(Inovout.View,{initialize:function($super,a){$super(a);var b=(new Function("return "+a.html().replace(/\n/g,"")))();a.empty();$(a.dom).highcharts(b);a.css("visibility","visible")}});
Inovout.Widgets.BinaryPad=Class.create(Inovout.View,{initialize:function($super,a){$super(a);this.navs=Inovout.Element.get(document).find(".binaryPad-nav>span");this.articles=a.children("article");var b=this;this.navs.each(function(a){a.click.addListener(function(a,d){b.navs.each(function(a){a.toggle()});b.articles.each(function(a){a.toggle()})})})}});
Inovout.Widgets.Wizard=Class.create(Inovout.View,{initialize:function($super,a){$super(a);this.navs=a.find("nav>span");this.articles=a.find("div>article");this.currentArticle=0;var b=this;this.navs[0].click.addListener(function(a,e){b.currentArticle--;b.show(b.currentArticle);b.currentArticle<b.articles.length-1&&b.navs[1].css("visibility","visible");0==b.currentArticle&&b.navs[0].css("visibility","hidden")});this.navs[1].click.addListener(function(a,e){b.currentArticle++;b.show(b.currentArticle);
0<b.currentArticle&&b.navs[0].css("visibility","visible");b.currentArticle==b.articles.length-1&&b.navs[1].css("visibility","hidden")});2<this.navs.length&&this.navs[2].click.addListener(function(a,e){b.currentArticle=b.articles.length-1;b.show(b.currentArticle)})},show:function(c){this.articles.each(function(a){a.hide()});this.articles[c].show()}});
