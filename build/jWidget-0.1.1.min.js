var Inovout={};
Inovout.Element=Class.create({initialize:function(b){var a=this;this.dom=b;this.dom.uid=(new Date).getTime()+""+parseInt(1E5*Math.random(),10);this.eventHnadles={};this.eventCallbacks={};"blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" ").each(function(c){var b=a[c]=new Event(c,a);b._addListener=b.addListener;b.addListener=function(d,k,f){b.hasListeners()||
a.bind(c,function(c){b.fire(a,{target:Inovout.Element.get(c.target)})});b._addListener(d,k,f)}})},complete:function(b,a){var c=Object.isString(b)?b:b.name,e,d=this;if(!(e=this.eventCallbacks[c])){e=this.eventCallbacks[c]=$.Callbacks();var k=jQuery._data(d.dom);d.eventHnadles[c]=k.handle||$.event.dispatch;d.removeEventtLister(c,d.eventHnadles[c]);d.addEventLister(c,function(a){var b=d.eventHnadles[c].apply(d.dom,arguments);e.fire(a);return b})}e.add(a)},addEventLister:function(b,a){var c=this.dom;
c.addEventListener?c.addEventListener(b,a,!1):c.attachEvent&&c.attachEvent("on"+b,a)},removeEventtLister:function(b,a){var c=this.dom;if(c.removeEventListener)c.removeEventListener(b,a,!1);else if(c.detachEvent){var e="on"+b;typeof c[e]===core_strundefined&&(c[e]=null);c.detachEvent(e,a)}},getClassName:function(){return this.dom.className},equals:function(b){return this.dom&&b.dom&&this.dom==b.dom},getAttributes:function(){return this.dom.attributes},toString:function(){return this.dom.uid}});
Object.extend(Inovout.Element,{cache:new HashMap,get:function(b){if("string"==typeof b)b=document.getElementById(b);else if(b instanceof Inovout.Element)return b;var a=Inovout.Element.cache.get(b);a||(a=new Inovout.Element(b),Inovout.Element.cache.add(b,a));return a}});Inovout.Element.prototype._initialize=Inovout.Element.prototype.initialize;
Inovout.Element.prototype.initialize=function(b){Object.extend(this,jQuery.fn);this.init(b);var a=this;["find"].each(function(c){a["_"+c]=a[c];a[c]=function(){var b=a["_"+c].apply(a,arguments);return jQuery.map(b,function(a){return Inovout.Element.get(a)})}});Inovout.Element.prototype._initialize.call(this,b)};Inovout.HAML={};
Inovout.HAML.EventAdapter=Class.create({initialize:function(b,a){this.event=b;this.buildFunction=a=a||Function.build;return this},listen:function(b,a){this.buildFunction("sender,args",this.fnExpression).call(this.scope,b,a)},addListener:function(b,a,c){this.fnExpression=b;this.scope=a;this.event.addListener(this.listen,this,c)}});
Inovout.HAML.EncryptInput=Class.create({initialize:function(b){var a=b.attr("name"),c=b.data("encrypt").split("|");b.removeAttr("name");var e=$("<input type='hidden' name="+a+" />");b.append(e);b.change.addListener(function(a,k){var f=b.val(),l=new RSAKey;l.setPublic(c[0],c[1]);e.val(l.encrypt(f))});return this}});Inovout.HAML.CommandBinder=Class.create(Inovout.HAML.EventAdapter,{initialize:function($super,a,c){$super(a,c);return this}});Inovout.Widgets={};
Inovout.View=Class.create({initialize:function(b){this.element=Inovout.Element.get(b);return this}});
Object.extend(Inovout.View,{cache:new HashMap,tryGet:function(b){for(var a in Inovout.Widgets){var c=a.substring(0,1).toLowerCase()+a.substring(1,a.length);if(b.hasClass(c)||a.toLowerCase()==b.dom.tagName.toLowerCase())return a=new Inovout.Widgets[a](b),Inovout.View.cache.add(b,a),a}},get:function(b){if(b instanceof Inovout.View)return b;b=Inovout.Element.get(b);var a=Inovout.View.cache.get(b)||Inovout.View.tryGet(b);a||(a=new Inovout.View(b),Inovout.View.cache.add(b,a),Object.extend(a,b));return a},
buildFunction:function(b,a){a=a.trim();var c=a.indexOf("."),e=a.substring(0,c);return"this."!=e&&""!=e?(a="Inovout.View.get("+e+")."+a.substring(c+1,a.length),Function(b,a)):Function.build(b,a)}});if(!iui){var iui={};iui.load=iui.load||jQuery(window).ready;iui.context={}}iui.load(function(){var b=Inovout.Element.get(document),a;for(a in Inovout.Widgets){var c=a.substring(0,1).toLowerCase()+a.substring(1,a.length);b.find("."+c+","+a).each(function(a){Inovout.View.get(a)})}});
var Page=Class.create(Inovout.View,{initialize:function($super,a){$super(a);return this},init:function(){this.parseEventAdapter(this.element)},parseEventAdapter:function(b){b=Inovout.Element.get(b);b.find("[ data-event-adapter]").each(function(a){a.attr("data-event-adapter").split(";").each(function(c){if(""!=c){c=c.split("=");var b=c[0].split("."),b=Inovout.View.get(b[0])[b[1]],b=new Inovout.HAML.EventAdapter(b),d=Inovout.View.get(a);b.addListener(c[1],d)}})});b.find("[data-encrypt]").each(function(a){new Inovout.HAML.EncryptInput(a)});
b.find("input[data-click-command]").each(function(a){var b=a.attr("data-click-command");(new Inovout.HAML.CommandBinder(a.click,Inovout.View.buildFunction)).addListener(b,a)})}});iui||(iui={},iui.load=iui.load||jQuery(window).ready,iui.context={});iui.context.page=new Page(document);iui.load(function(){iui.context.page.init()});
Inovout.Widgets.List=Class.create(Inovout.View,{initialize:function($super,a){$super(a);this.selectedChanged=new Event("selectedChanged",this);return this},bindData:function(b){Object.isJSON(b)?(element.empty(),$.each(b,function(a,b){this.add(b)})):$.getJSON(b).done(function(a){this.bindData(a)})},wrapEventArgs:function(b){var a={text:b.text()};Object.extend(a,b.data());a.value=a.value||b.val()||b.text();return a},valueKeys:void 0});
Inovout.Widgets.DropDownList=Class.create(Inovout.Widgets.List,{initialize:function($super,a){$super(a);var c=this;a.change.addListener(function(a,d){var k=c.element.children("option:selected")[0];c.selectedChanged.fire(c,c.wrapEventArgs(k))});return this},add:function(b){this.element.append('<option value="'+b.value+'">'+b.value+"</option>")}});
Inovout.Widgets.TabList=Class.create(Inovout.Widgets.List,{initialize:function($super,a){$super(a);this.selectedChanged=new Event("selectedChanged",this);var c=this;this.element.children().each(function(a){a.click.addListener(function(a,e){var f=c.element.find("li.selected")[0];if(!a.equals(f)){f.removeClass("selected");a.addClass("selected");f={text:a.text()};if(!c.valueKeys){c.valueKeys=[];for(var l=a.getAttributes(),g=0;g<l.length;g++){var h=l[g].name;-1<h.indexOf("data-")&&c.valueKeys.push(h.substring(5,
h.length))}}for(g=0;g<c.valueKeys.length;g++)f[c.valueKeys[g]]=a.attr("data-"+c.valueKeys[g]);f.value=f.value||a.text();c.selectedChanged.fire(c,f)}})});return this},valueKeys:void 0});
Inovout.Widgets.Form=Class.create(Inovout.View,{initialize:function($super,a){function c(c){debugger;var f=new Uri(a.prop("action")),d=a.serializeJSON(),g=new HttpRequest(a.prop("method"),f),h,m=new HttpClient;enctype=a.attr("enctype");if(0<f.uri.indexOf("["))for(name in d)f.uri=f.uri.replace(RegExp("\\["+name+"\\]","ig"),d[name]);"post"==g.method&&("application/x-www-form-urlencoded"==enctype?h=new JsonContent(d):"multipart/related"==enctype&&(f="iui_"+(""+Math.random()).replace(/\D/g,""),h=new MultipartContent("related",
f),h.add(new JsonContent(d)),a.find(".fileInput").each(function(a){h.add(new FileContent(Inovout.View.get(a.fileInput.files[0])))})),g.content=h);m.send(g).read().done(function(a){debugger;Inovout.View.buildFunction("data",c).call(e,a)})}$super(a);var e=this,d=a.data("async");d&&(a.complete(a.submit,function(a){a.defaultPrevented||(a.preventDefault(),a.stopPropagation(),c(d))}),a.find("input[type=file]").each(function(a){var c=$('<div class="fileInput"><button type="button" class="fileInput_browse_button">\u6d4f\u89c8</button></div>')[0];
a.replaceWith(c);Inovout.View.get(c)}));return this}});Inovout.Widgets.FileInput=Class.create(Inovout.View,{initialize:function($super,a){$super(a);var c=this,e={browse_button:a.find(".fileInput_browse_button")[0].dom,container:a.dom};a.data("multiple")&&(e.multiple=!0);this.selectedChanged=new Event("selectedChanged",this);this.fileInput=new o.FileInput(e);this.fileInput.onchange=function(a){c.selectedChanged.fire(c,a.target.files)};this.fileInput.init();return this}});
Inovout.Widgets.DataChart=Class.create(Inovout.View,{initialize:function($super,a){$super(a);var c=(new Function("return "+a.html().replace(/\n/g,"")))();a.empty();$(a.dom).highcharts(c);a.css("visibility","visible")}});
Inovout.Widgets.BinaryPad=Class.create(Inovout.View,{initialize:function($super,a){$super(a);this.navs=Inovout.Element.get(document).find(".binaryPad-nav>span");this.articles=a.children("article");var c=this;this.navs.each(function(a){a.click.addListener(function(a,e){c.navs.each(function(a){a.toggle()});c.articles.each(function(a){a.toggle()})})})}});
Inovout.Widgets.Wizard=Class.create(Inovout.View,{initialize:function($super,a){$super(a);this.navs=a.find("nav>span");this.articles=a.find("div>article");this.currentArticle=0;var c=this;this.navs[0].click.addListener(function(a,d){c.currentArticle--;c.show(c.currentArticle);c.currentArticle<c.articles.length-1&&c.navs[1].css("visibility","visible");0==c.currentArticle&&c.navs[0].css("visibility","hidden")});this.navs[1].click.addListener(function(a,d){c.currentArticle++;c.show(c.currentArticle);
0<c.currentArticle&&c.navs[0].css("visibility","visible");c.currentArticle==c.articles.length-1&&c.navs[1].css("visibility","hidden")});2<this.navs.length&&this.navs[2].click.addListener(function(a,d){c.currentArticle=c.articles.length-1;c.show(c.currentArticle)})},show:function(b){this.articles.each(function(a){a.hide()});this.articles[b].show()}});
Inovout.Widgets.DataTable=Class.create(Inovout.View,{initialize:function($super,a){$super(a);this.selectedRowsChanged=new Event("selectedRowsChanged",this);return this},selectRow:function(b){var a=b.parent().parent();this.element.find(".selected").each(function(a){a.removeClass("selected")});a.toggleClass("selected");this.selectedRowsChanged.fire(this,this.wrapEventArgs(b))},insertNewRow:function(b,a){var c=$.templates("#"+a).render(b);this.element.append("<tr>"+c+"</tr>")},wrapEventArgs:function(b){b=
!1;var a=0;this.element.find(".selected").each(function(b){a++});0<a&&(b=!0);return{hasSelected:b}}});
